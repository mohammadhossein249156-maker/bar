<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ“Š Crypto Dashboard â€“ Responsive</title>
<style>
body{font-family:tahoma,Arial,sans-serif;direction:rtl;background:#f5f7fb;margin:0}
header{background:#1e88e5;color:#fff;padding:10px;text-align:center;font-size:13px}
.wrap{max-width:1600px;margin:12px auto;padding:0 6px}
.controls{display:flex;gap:5px;align-items:center;flex-wrap:wrap;margin-bottom:6px;font-size:12px}
input,select,button{padding:4px 6px;border:1px solid #cfd8dc;border-radius:4px;font-family:inherit;font-size:11px}
button{background:#1e88e5;color:#fff;cursor:pointer}
button:disabled{background:#90caf9;cursor:not-allowed}
.note{font-size:10px;color:#546e7a;margin-top:3px}
.table-wrap{overflow:auto;background:#fff;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
table{border-collapse:collapse;width:100%;font-size:11px}
th,td{border-bottom:1px solid #eee;padding:2px 4px;text-align:center;white-space:nowrap}
th{background:#e3f2fd;color:#0d47a1;position:sticky;top:0;z-index:1}
tr:hover{background:#fafcff}
.correction-ok{background:#e8f5e9;color:#2e7d32;font-weight:600;border-radius:3px;padding:1px 3px}
.correction-warning{background:#ffe0b2;color:#ef6c00;font-weight:600;border-radius:3px;padding:1px 3px}
/* Ø±Ù†Ú¯ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ */
.row-color-0{background:#ffffff;}
.row-color-1{background:#f0f8ff;}
.row-color-2{background:#f5f5dc;}
.row-color-3{background:#f0fff0;}
.row-color-4{background:#fffaf0;}

/* ğŸ“± Ø­Ø§Ù„Øª Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±ØªÛŒ) */
@media (max-width: 600px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }
  thead { display: none; }
  tr {
    margin: 0 0 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #fff;
    padding: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  td {
    text-align: right;
    padding: 4px 6px;
    border: none;
    display: flex;
    justify-content: space-between;
  }
  td::before {
    content: attr(data-label);
    font-weight: bold;
    margin-left: 6px;
    color: #0d47a1;
  }
}
</style>
</head>
<body>
<header>
<h2>ğŸ“Š Crypto Dashboard â€“ Responsive</h2>
<div style="font-size:10px;opacity:.9">Ù…Ù†Ø¨Ø¹ Ø¯Ø§Ø¯Ù‡: Binance (OHLCV) | Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</div>
</header>

<div class="wrap">
<div class="controls">
<label>ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…:</label>
<select id="interval">
<option value="5m">5m</option>
<option value="15m" selected>15m</option>
<option value="1h">1h</option>
<option value="4h">4h</option>
<option value="1d">1d</option>
</select>
<button id="refreshBtn">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
<input type="text" id="searchBox" placeholder="Search Symbol..." />
<button id="saveBtn">ğŸ“¥ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù†ÙˆØªâ€ŒÙ¾Ø¯</button>
<span id="lastUpdate" class="note"></span>
</div>

<div class="table-wrap">
<table id="crypto-table">
<thead>
<tr>
<th>Symbol</th><th>Interval</th><th>Price</th><th>RSI</th><th>EMA9</th><th>EMA20</th><th>EMA50</th><th>EMA100</th><th>EMA200</th>
<th>MACD</th><th>Signal</th><th>Support</th><th>Resistance</th><th>OnSupport</th><th>OnResistance</th>
<th>Breakout</th><th>Bounce</th><th>Golden</th><th>Rally</th><th>Strategy</th><th>Correction</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="note">Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± ØµØ±ÙØ§Ù‹ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø§Ø³Øª Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚Ø·Ø¹ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø­Ø³ÙˆØ¨ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
</div>

<script>
const SYMBOLS = ["BTCUSDT","ETHUSDT","BNBUSDT","XRPUSDT","SOLUSDT","ADAUSDT","DOGEUSDT","TRXUSDT","MATICUSDT","DOTUSDT","LTCUSDT","AVAXUSDT","LINKUSDT","ATOMUSDT","ETCUSDT","XLMUSDT","FILUSDT","APTUSDT","NEARUSDT","ARBUSDT"];
const INTERVALS = ["5m","15m","1h","4h","1d"];
const PROXY = url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;

const fmt = (n,d=2) => (n==null||isNaN(n)?"-":Number(n).toLocaleString(undefined,{maximumFractionDigits:d}));
const withinPct = (price, level, pct=0.3) => price && level ? Math.abs((price-level)/level)*100<=pct : false;

function ema(values, period){ if(!values||values.length===0) return []; const k=2/(period+1); const out=[]; let prev=values[0]; out.push(prev); for(let i=1;i<values.length;i++){const v=values[i]*k+prev*(1-k);out.push(v); prev=v;} return out;}
function rsi(values, period=14){if(!values||values.length<period+1)return[];let gains=0,losses=0;for(let i=1;i<=period;i++){const diff=values[i]-values[i-1];diff>=0?gains+=diff:losses-=diff;}let avgGain=gains/period,avgLoss=losses/period;const out=new Array(period).fill(null);for(let i=period+1;i<values.length;i++){const diff=values[i]-values[i-1];const gain=diff>0?diff:0;const loss=diff<0?-diff:0;avgGain=(avgGain*(period-1)+gain)/period;avgLoss=(avgLoss*(period-1)+loss)/period;const rs=avgLoss===0?1000:avgGain/avgLoss;out.push(100-(100/(1+rs)));}return out;}
function macd(values, fast=12, slow=26, signalPeriod=9){const ef=ema(values,fast); const es=ema(values,slow); const macdLine=ef.map((v,i)=>(es[i]==null?null:(v-es[i]))); const start=slow; const macdValid=macdLine.slice(start).filter(v=>v!=null); const signalPart=ema(macdValid,signalPeriod); return {macdLine, signalLine:new Array(start).fill(null).concat(signalPart)};}
async function fetchKlines(symbol,interval="15m",limit=300){const res = await fetch(PROXY(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`));const data = await res.json();return Array.isArray(data)?data:[];}
function decideStrategy({last, ema20v, ema50v, ema200v, rsiv, macdv, sigv}){if(last>ema20v && last>ema50v && ema50v>ema200v && macdv>sigv && rsiv>50) return "Ù‡ÙˆÙ„Ø¯"; if(last<ema20v && last<ema50v && ema50v<ema200v && macdv<sigv && rsiv<50) return "ÙØ±ÙˆØ´"; return "Ù†ÙˆØ³Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ";}
function correctionBadge({last, ema20v, ema50v, rsiv, macdv, sigv}){return (last<ema20v && last<ema50v && rsiv<50 && macdv<sigv)?'âš ï¸':'âœ…';}

async function buildTable(symbolFilter=null){
    const tbody = document.querySelector("#crypto-table tbody");
    tbody.innerHTML="";
    document.getElementById("refreshBtn").disabled=true;

    const symbolsToProcess = symbolFilter ? SYMBOLS.filter(s=>s.includes(symbolFilter)) : SYMBOLS;
    const intervalsToProcess = symbolFilter ? INTERVALS : [document.getElementById("interval").value];

    const headers = ["Symbol","Interval","Price","RSI","EMA9","EMA20","EMA50","EMA100","EMA200",
     "MACD","Signal","Support","Resistance","OnSupport","OnResistance",
     "Breakout","Bounce","Golden","Rally","Strategy","Correction"];

    for(let si=0; si<symbolsToProcess.length; si++){
        const symbol = symbolsToProcess[si];
        const rowColorClass = `row-color-${si%5}`;
        for(const interval of intervalsToProcess){
            try{
                const kl = await fetchKlines(symbol, interval, 300);
                if(!kl.length) continue;
                const closes = kl.map(k=>+k[4]);
                const last = closes.at(-1)||0;
                const ema9v = ema(closes,9).at(-1)||0;
                const ema20v = ema(closes,20).at(-1)||0;
                const ema50v = ema(closes,50).at(-1)||0;
                const ema100v = ema(closes,100).at(-1)||0;
                const ema200v = ema(closes,200).at(-1)||0;
                const rsiv = rsi(closes,14).at(-1)||0;
                const {macdLine, signalLine} = macd(closes,12,26,9);
                const macdv = macdLine.at(-1)||0;
                const sigv = signalLine.at(-1)||0;

                const strategy = decideStrategy({last, ema20v, ema50v, ema200v, rsiv, macdv, sigv});
                const correction = correctionBadge({last, ema20v, ema50v, rsiv, macdv, sigv});

                const last20 = closes.slice(-20);
                const support = Math.min(...last20);
                const resistance = Math.max(...last20);

                let onSupport = "â€”", onResistance = "â€”";
                if(withinPct(last, support,0.3)) onSupport = "âœ…";
                else if(withinPct(last,resistance,0.3)) onResistance = "âœ…";

                const breakout = last>resistance*1.002?"âœ…":"â€”";
                const prevRsi = rsi(closes,14).slice(-2)[0]||0;
                const bounce = withinPct(last,support,0.3) && rsiv>prevRsi?"âœ…":"â€”";
                const ema50Prev = ema(closes,50).slice(-2)[0]||0;
                const ema200Prev = ema(closes,200).slice(-2)[0]||0;
                const golden = ema50Prev<ema200Prev && ema50v>ema200v?"âœ…":"â€”";
                const rally = last>ema9v && last>ema20v && rsiv>70 && macdv>sigv?"âœ…":"â€”";

                const tr = document.createElement("tr");
                tr.className = rowColorClass;
                const cells = [
                  symbol, interval, fmt(last,4), fmt(rsiv,2), fmt(ema9v,4), fmt(ema20v,4),
                  fmt(ema50v,4), fmt(ema100v,4), fmt(ema200v,4), fmt(macdv,6), fmt(sigv,6),
                  fmt(support,4), fmt(resistance,4), onSupport, onResistance,
                  breakout, bounce, golden, rally, strategy, correction
                ];
                cells.forEach((val,i)=>{
                  const td = document.createElement("td");
                  td.textContent = val;
                  td.setAttribute("data-label", headers[i]);
                  tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }catch(err){
                const tr = document.createElement("tr");
                tr.className = `row-color-${si%5}`;
                const td = document.createElement("td");
                td.colSpan = headers.length;
                td.style.color="red";
                td.textContent = `Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ ${symbol} (${interval}): ${err.message}`;
                tr.appendChild(td);
                tbody.appendChild(tr);
            }
        }
    }
    document.getElementById("lastUpdate").textContent = "Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: "+new Date().toLocaleString();
    document.getElementById("refreshBtn").disabled=false;
}

// Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± txt
function saveTableToTxt(){
    const table = document.getElementById("crypto-table");
    let txt = "";
    const headers = Array.from(table.querySelectorAll("thead th")).map(th=>th.textContent.trim()).join("\t");
    txt += headers+"\n";
    table.querySelectorAll("tbody tr").forEach(row=>{
        const cells = Array.from(row.querySelectorAll("td")).map(td=>td.textContent.trim()).join("\t");
        txt+=cells+"\n";
    });
    const blob = new Blob([txt],{type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href=url; a.download="crypto_data.txt"; a.click();
    URL.revokeObjectURL(url);
}

document.getElementById("refreshBtn").addEventListener("click",()=>buildTable());
document.getElementById("searchBox").addEventListener("change",e=>buildTable(e.target.value.toUpperCase()));
document.getElementById("saveBtn").addEventListener("click",saveTableToTxt);

buildTable();
</script>
</body>
</html>
