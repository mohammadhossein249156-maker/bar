<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ“Š Crypto Dashboard â€“ Top 20</title>
  <style>
    body{font-family:tahoma,Arial,sans-serif;direction:rtl;background:#f5f7fb;margin:0}
    header{background:#1e88e5;color:#fff;padding:14px 10px;text-align:center}
    .wrap{max-width:1500px;margin:16px auto;padding:0 12px}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
    input,select,button{padding:8px 10px;border:1px solid #cfd8dc;border-radius:8px;font-family:inherit}
    button{background:#1e88e5;color:#fff;cursor:pointer}
    button:disabled{background:#90caf9;cursor:not-allowed}
    .note{font-size:12px;color:#546e7a;margin-top:6px}
    .table-wrap{overflow:auto;background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.08)}
    table{border-collapse:collapse;width:100%}
    th,td{border-bottom:1px solid #eee;padding:8px 10px;text-align:center;white-space:nowrap;font-size:13px}
    th{background:#e3f2fd;color:#0d47a1;position:sticky;top:0;z-index:1}
    tr:hover{background:#fafcff}
    .positive{color:#2e7d32;font-weight:600}
    .negative{color:#c62828;font-weight:600}
    .badge{padding:2px 6px;border-radius:8px;font-weight:600}
    .good{background:#e8f5e9;color:#2e7d32}
    .bad{background:#ffebee;color:#c62828}
    .neutral{background:#eceff1;color:#37474f}
    .muted{color:#607d8b}
    .nowrap{white-space:nowrap}
    /* ğŸ”¹ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø±Ø¯ÛŒÙ Ø¬Ø³ØªØ¬Ùˆ */
    .highlight {background:#fff9c4 !important;}
  </style>
</head>
<body>
  <header>
    <h2>ğŸ“Š Crypto Dashboard â€“ Top 20</h2>
    <div style="font-size:12px;opacity:.9">
      Ù…Ù†Ø¨Ø¹ Ø¯Ø§Ø¯Ù‡: Binance (OHLCV) Ø§Ø² Ø·Ø±ÛŒÙ‚ Codetabs Proxy | Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
    </div>
    <!-- ğŸ”¹ ÙÛŒÙ„Ø¯ Ø¬Ø³ØªØ¬Ùˆ -->
    <div style="margin-top:10px">
      <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ù…Ø¨Ù„..." />
    </div>
  </header>

  <div class="wrap">
    <div class="controls">
      <label>ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…:</label>
      <select id="interval">
        <option value="5m">5m</option>
        <option value="15m" selected>15m</option>
        <option value="1h">1h</option>
        <option value="4h">4h</option>
        <option value="1d">1d</option>
      </select>
      <button id="refreshBtn">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
      <span id="lastUpdate" class="note"></span>
    </div>

    <div class="table-wrap">
      <table id="crypto-table">
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Price</th>
            <th>RSI(14)</th>
            <th>EMA9</th>
            <th>EMA20</th>
            <th>EMA50</th>
            <th>EMA100</th>
            <th>MACD</th>
            <th>Signal</th>
            <th>L</th>
            <th>S</th>
            <th>PP</th>
            <th>Long</th>
            <th>Short</th>
            <th>Entry</th>
            <th>Exit (TP/SL)</th>
            <th>Support</th>
            <th>Resistance</th>
            <th>ØªØ«Ø¨ÛŒØª Ø±ÙˆÛŒ Ø­Ù…Ø§ÛŒØªØŸ</th>
            <th>ØªØ«Ø¨ÛŒØª Ø±ÙˆÛŒ Ù…Ù‚Ø§ÙˆÙ…ØªØŸ</th>
            <th>Breakout</th>
            <th>Bounce</th>
            <th>Golden Cross</th>
            <th>Rally</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="note">
      Ù†Ú©ØªÙ‡: Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± ØµØ±ÙØ§Ù‹ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø§Ø³Øª Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ù‚Ø·Ø¹ÛŒ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ù…Ø­Ø³ÙˆØ¨ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </div>
  </div>

<script>
// ====== Config ======
const SYMBOLS = [
  "BTCUSDT","ETHUSDT","BNBUSDT","XRPUSDT","SOLUSDT",
  "ADAUSDT","DOGEUSDT","TRXUSDT","MATICUSDT","DOTUSDT",
  "LTCUSDT","AVAXUSDT","LINKUSDT","ATOMUSDT","ETCUSDT",
  "XLMUSDT","FILUSDT","APTUSDT","NEARUSDT","ICPUSDT"
];
const PROXY = (url) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;
const fmt = (n, d=2) => (n==null || isNaN(n)) ? "-" : Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
const withinPct = (price, level, pct=0.3) => {
  if (!price || !level) return false;
  const diff = Math.abs((price - level)/level)*100;
  return diff <= pct;
};

// ====== Data Fetch ======
async function fetchKlines(symbol, interval="15m", limit=300){
  const url = PROXY(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
  const res = await fetch(url);
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  const data = await res.json();
  if(!Array.isArray(data)) throw new Error("Bad payload");
  return data;
}

async function fetchDailyPivot(symbol){
  const url = PROXY(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&limit=3`);
  const res = await fetch(url);
  if(!res.ok) return null;
  const data = await res.json();
  if(!Array.isArray(data) || data.length < 2) return null;
  const prev = data[data.length-2];
  const H = +prev[2], L = +prev[3], C = +prev[4];
  const PP = (H+L+C)/3;
  return PP;
}

// ====== Indicators ======
function ema(values, period){ ... } // â† Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±
function rsi(values, period=14){ ... }
function macd(values, fast=12, slow=26, signalPeriod=9){ ... }
function atr(highs, lows, closes, period=14){ ... }

// ====== Main Build ======
async function buildTable(){
  const tbody = document.querySelector("#crypto-table tbody");
  tbody.innerHTML = "";
  const interval = document.getElementById("interval").value;

  // ğŸ”¹ Ú¯Ø±ÙØªÙ† Ù…ØªÙ† Ø¬Ø³ØªØ¬Ùˆ
  const searchValue = document.getElementById("searchInput").value.trim().toUpperCase();

  for(const symbol of SYMBOLS){
    // ğŸ”¹ ÙÛŒÙ„ØªØ± Ø¨Ø±Ø§Ø³Ø§Ø³ Ø¬Ø³ØªØ¬Ùˆ
    if(searchValue && !symbol.includes(searchValue)) continue;
    
    try{
      const [kl, pp] = await Promise.all([fetchKlines(symbol, interval, 300), fetchDailyPivot(symbol)]);
      // ... Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù‚Ø¨Ù„ÛŒ

      const tr = document.createElement("tr");
      tr.innerHTML = `...`; // (Ú©Ø¯ Ù‚Ø¨Ù„ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø³Ø·Ø± Ø¬Ø¯ÙˆÙ„)

      // ğŸ”¹ Ø§Ú¯Ø± Ø¬Ø³ØªØ¬Ùˆ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯ Ùˆ Ø³Ù…Ø¨Ù„ Ù…Ø·Ø§Ø¨Ù‚ â†’ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª
      if(searchValue && symbol.includes(searchValue)) {
        tr.classList.add("highlight");
      }

      tbody.appendChild(tr);
    }catch(err){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="24" class="negative">Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ ${symbol}: ${err.message}</td>`;
      tbody.appendChild(tr);
    }
  }

  document.getElementById("lastUpdate").textContent =
    "Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: " + new Date().toLocaleString();
}

document.getElementById("refreshBtn").addEventListener("click", buildTable);
document.getElementById("searchInput").addEventListener("input", buildTable); // ğŸ”¹ Ø§Ø¬Ø±Ø§ Ø¯Ø± Ù„Ø­Ø¸Ù‡ ØªØ§ÛŒÙ¾
buildTable();
setInterval(buildTable, 60000);
</script>
</body>
</html>

